---
title: 【git】マージ取り消しの方法を解説
date: 2023-08-22
writtenBy: me
category: tec
tags: [git]
related: []
thumbnail: /images/git.jpg
description: Gitユーザー向けに、マージ作業の取り消し方法を詳しく解説。コンフリクト解消からコミット後の後悔まで、4つの手順をわかりやすく紹介。
---

こんにちは、Git ユーザーの皆さん。git でマージ作業を進めていたけれど、いくつかの理由からやっぱりその作業を取り消したい場合に使える方法を紹介します。

## 「git merge」とその必要性の理解

ここでは、「git merge」とその取り消しの必要性について説明します。

### 「git merge」の重要性と役割

「git merge」は、複数の開発ブランチを統合するための Git の主要な機能です。これにより、各開発者は独立して作業を進め、最終的にその成果をメインのブランチに統合できます。例えば、開発者 A と B が同時に作業を進めている場合、A が新しい機能を完成させたとしても、B の作業に影響を与えずに、成果物をメインのブランチに統合できます。

### 「git merge」の問題と取り消しの必要性

しかしながら、「git merge」は常に順調に進むわけではありません。以下の問題が発生する可能性があります。

- コードの競合
- 未解決のバグ
- 間違ったブランチへのマージ

したがって、時折マージを取り消す必要が出てきます。

マージを取り消す必要性を理解し、それに対処する方法を学ぶことは、効果的なソフトウェア開発の一環です。

## 「git merge」操作後の取り消しケースと注意点

次に、「git merge」操作が完了した後の取り消しケースと注意点について詳しく説明します。
これらの知識を持つことで、問題が発生した場合の適切な対処法が明確になります。

- 「git merge」完了後の取り消し手順
- マージ完了後の取り消しとそのリスク
- 「git merge」途中での取り消しと注意事項

### 「git merge」完了後の取り消し手順

「git merge」が完全に終了し、変更が既にプッシュされた場合でも、取り消しは可能です。
具体的な方法としては、適切な選択肢である「git reset」コマンドや「git revert」コマンドを使用できます。ただし、これらのコマンドには異なる効果とリスクが伴うため、慎重に選択することが重要です。

### マージ完了後の取り消しとそのリスク

「git merge」完了後の取り消しにはいくつかのリスクが伴います。

#### 開発者間の混乱

マージの取り消しにより、他の開発者が参照したマージ結果が無効になる可能性があります。そのため、他の開発者がそのマージ結果に基づいて新たな開発を進めていないかを確認することが重要です。

#### コードの整合性

マージの取り消しにより、コードの整合性が崩れる可能性があります。取り消しにより、マージで統合されたコードの一部が削除されるため、一部の関数やクラスが欠落する可能性があります。これにより、プログラム全体が正常に動作しなくなる可能性があります。

#### 履歴の変更

マージの取り消しにより、Git のコミット履歴が変更されます。適切に管理されていない場合、どのコミットが問題を引き起こしたのかを追跡することが難しくなる可能性があるため、慎重に対処する必要があります。

## 1. マージしてコンフリクト発生。取り消したい時

マージ中に予期せぬコンフリクトが発生してしまい、「やっぱりやーめた」ってなったことってありますよね。ただし、コンフリクト解消のための編集がまだ行われていない場合に限ります。

```bash
$ git merge --abort
```

これで、マージ前の状態に戻ることができます。

## 2. マージしてコンフリクト発生。解消編集したけど、結局取り消したい時

コンフリクト解消のためにコードをいろいろ編集してみたけど、結局マージはやめたい場合です。

```bash
$ git reset --hard HEAD
```

このコマンドを使うと、行った編集とマージ作業を一度にキャンセルできます。

## 3. マージ完了して後悔。パート 1

マージが完了して（コミットまで行った）けれども、やっぱりマージ前の状態に戻りたい場合です。ここでは、revert コマンドを使って、マージコミットを無かったことにします。

```bash
$ git revert -m 1 <merge_commit>
```

ただし、マージコミットの場合、親が 2 つに分かれていることを忘れずに。revert コマンドを使う場合は、どちらの親に戻すかを-m 数字で指定します。数字が親を示します。

詳細は[こちらの記事](/tec/git_what_revert)を参照してください。

### ただし、注意が必要です！その 3 パート 1

この方法を使うと、取り消したマージコミットに含まれていた変更を再度マージすることはできなくなります。例えば、
ブランチ A に対してブランチ B をマージ
↓
マージコミットを revert して、ブランチ A の状態に戻す
↓
ブランチ A に再びブランチ B をマージ ← これはできないです（変更が取り込まれない）

revert コマンドを使うと、コミット履歴には「マージした」という記録は残ったまま、実際のコード差分は残りません。

## 4. マージ完了して後悔。パート 2

マージが完了して（コミットまで行った）けれども、やっぱりマージ前の状態に戻りたい場合です。こちらは reset コマンドを使用して、コミットの履歴自体を取り消します。

```bash
$ git reset --hard ORIG_HEAD
```

これで、マージする前の HEAD の状態に一気に戻ることができます。

ただし、注意が必要です！その方法は一度行ったコミットを取り消すことになります。revert コマンドとは違い、「コミットを取り消した」という履歴は残りません。一度 push などを行って他の開発者に公開されているコミットを取り消すのは避けましょう。自分のローカルでのみ行った変更を元に戻したい場合にのみ使用しましょう。

以上が、マージの取り消しに関する方法 4 つの紹介です。必要な場面で使って、スムーズな開発を進めましょう。
